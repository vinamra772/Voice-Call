<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Only Us ‚ù§Ô∏è</title>
<link rel="icon" href="icon.png" type="image/png">
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/agora-rtc-sdk-ng@4.20.2"></script>
<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #ff9a9e, #fad0c4);
  overflow: hidden;
  color: #fff;
  text-align: center;
}
h2 { font-size:2.2rem; margin-bottom:1rem; text-shadow:2px 2px 6px rgba(0,0,0,0.2);}
.btn { padding:12px 24px; margin:10px; font-size:1.1rem; font-weight:bold; border:none; border-radius:30px; cursor:pointer; transition: all 0.3s ease; }
#joinBtn { background: #ff4b5c; color:white; box-shadow:0 4px 15px rgba(255,75,92,0.4);}
#leaveBtn { background: #444; color:white; box-shadow:0 4px 15px rgba(0,0,0,0.3);}
.btn:hover:not([disabled]){transform:scale(1.05);}
.btn:disabled{opacity:0.5; cursor:not-allowed;}
#status{margin-top:20px; font-size:1.2rem; font-style:italic;}
.message{
  position:absolute;
  bottom:-50px;
  left:50%;
  transform:translateX(-50%);
  padding:8px 14px;
  border-radius:12px;
  font-weight:bold;
  background:rgba(255,255,255,0.2);
  backdrop-filter:blur(6px);
  color:transparent;
  text-shadow:0 0 8px rgba(255,255,255,0.8);
  cursor:pointer;
  transition:all 0.4s ease;
  white-space:normal;
  max-width:90vw;
  overflow-wrap:break-word;
  word-break:break-word;
  text-align:center;
}
.message.revealed{
  color:#fff;
  text-shadow:none;
  backdrop-filter:blur(0px);
  background:rgba(0,0,0,0.3);
  transform:scale(1.2)!important;
  box-shadow:0 0 20px rgba(255,255,255,0.6);
}
@keyframes floatMsg{
  0%{transform:translateY(0) translateX(-50%);opacity:1;}
  100%{transform:translateY(-110vh) translateX(-50%);opacity:0;}
}
</style>
</head>
<body>
<h2>Only Us ‚ù§Ô∏è Voice Call</h2>
<div>
  <button id="joinBtn" class="btn">Call na Prakritii</button>
  <button id="leaveBtn" class="btn" disabled>Please Don't ü•∫</button>
</div>
<div id="status">Not connected</div>

<script>
const APP_ID = "ae2ce2e790744908bc1312432be83ae4"; // make sure certificate is OFF if using null token
const CHANNEL = "myLoveChannel2025";
const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

let localTrack;

// floating messages
const messages=[
  "üåç My world Nonu!!","üíï Mjhe song kab sunaoge","üå∏ Aap itne cute kaise ho","‚ú® Ladte bhi ho mere se itna zyda",
  "ü•∞ Aapki hasi meri fav hai","üí´ Aapki voice to soo soothing","üåπ Thoda smile kr dijiye","üòû How will I live without you",
  "ü´Ä Mjhe hmesha aapki need rhegi","ü•∫ Yad rkhoge na mjhe Nonu","üí™ Meri biceps dekh kr dar lga","‚òÄÔ∏è Cutie",
  "üî• Aap jaha hote ho wha to hmesha summer hi hota hoga","üòá Kbhi socha bhi nahi tha ki ye sab creativity bhi hai mere andr",
  "üåª You brighten my day","ü¶ã My little butterfly"
];

function createMessage(){
  const msg=document.createElement("div");
  msg.className="message";
  msg.textContent=messages[Math.floor(Math.random()*messages.length)];
  document.body.appendChild(msg);

  requestAnimationFrame(()=>{
    const duration = 10 + Math.random()*5;
    msg.style.animation = `floatMsg ${duration}s linear forwards`;
    setTimeout(()=>msg.remove(), duration*1000);
  });
}
setInterval(createMessage, 2500);

// JOIN CALL
document.getElementById("joinBtn").onclick = async () => {
  try {
    document.getElementById("joinBtn").disabled = true;
    await client.join(APP_ID, CHANNEL, null, null);
    localTrack = await AgoraRTC.createMicrophoneAudioTrack({
      encoderConfig: "high_quality",
      AEC: true,
      AGC: true,
      ANS: true
    });
    await client.publish([localTrack]);
    document.getElementById("status").textContent = "üíñ Connected! Waiting for your partner...";
    document.getElementById("leaveBtn").disabled = false;

    // fix autoplay issues
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    if (ctx.state === "suspended") {
      await ctx.resume();
    }
  } catch (err) {
    console.error("Join error:", err);
    document.getElementById("status").textContent = "‚ùå Failed to join: " + err.message;
    document.getElementById("joinBtn").disabled = false;
  }
};

// REMOTE AUDIO
client.on("user-published", async (user, mediaType) => {
  try {
    await client.subscribe(user, mediaType);
    if (mediaType === "audio") {
      user.audioTrack.play();
      user.audioTrack.setVolume(100);
      document.getElementById("status").textContent = "üé∂ You‚Äôre talking now!";
    }
  } catch (err) {
    console.error("Subscribe error:", err);
  }
});

client.on("user-unpublished", user => {
  document.getElementById("status").textContent = "Partner left üò¢";
});

// LEAVE CALL
document.getElementById("leaveBtn").onclick = async () => {
  try {
    document.getElementById("leaveBtn").disabled = true;
    if (localTrack) {
      localTrack.stop();
      localTrack.close();
    }
    await client.leave();
    document.getElementById("status").textContent = "üëã Call ended";
    document.getElementById("joinBtn").disabled = false;
  } catch (err) {
    console.error("Leave error:", err);
  }
};
</script>
</body>
</html>
